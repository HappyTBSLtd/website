define([],function(){function e(e){require(["jquery","common/regexhelper/regexhelper","common/api/api.guid","libs/jquery/plugins/jquery.xDomainRequest","wsbcore/tipper","wsbcore/datepicker","libs/jquery/plugins/jquery.watermark/jquery.watermark"],function(t,n,r){function d(){if(g(),T()){var n=[],d="",o="",l=!0,u={},p=('[data-groupId="'+e.groupId+'"]',a?a.find('[data-groupId="'+e.groupId+'"]'):t('[data-groupId="'+e.groupId+'"]'));p.sort(function(e,a){var n=function(e){return t(e).attr("tabindex")||0};return n(e)-n(a)}).each(function(){var a=t(this),r=a.attr("data-formtype");if("date"!=r){var i=a.attr("type");if("button"!=i&&"submit"!=i&&("radio"!=i&&"checkbox"!=i||a.is(":checked"))){var s=a.attr("data-label");if(!s){var p=(u[r]||0)+1;u[r]=p,s=(e.fieldFormatByType[r]||"{num}").replace("{num}",p.toLocaleString())}var f=a.val();if(a.attr("data-namefield"))d=f;else if(a.attr("data-gemsubmit")&&"true"===a.attr("data-gemsubmit").toLowerCase()){o=f;var c=a.parent().find(".opt-in-checkbox");c&&c.is(":checked")&&(l=!1)}n.push({label:s,value:f,type:r})}}});var h={domainName:e.domainName,resellerId:e.resellerId,elementId:r.toLegacyIdString(e.elementId),subject:e.subject,emailHashList:e.emailHashList,formFields:n,hostPageUrl:encodeURIComponent(window.location.href)},m='input[type="hidden"][data-groupId="'+e.groupId+'"][data-formType="file"]',v=a?a.find(m):t(m);v.length&&v.val()&&(h.uploadedFileUrl=encodeURIComponent(v.val()));var I=function(){if(s){var n='div[data-label-container-groupId="'+e.groupId+'"]',r=a?a.find(n):t(n),d=1/0;t.each(r,function(e,a){var n=parseInt(t(a).parent().parent().css("top"))||0;d=Math.min(n,d)});var o=r.parent().parent(),l=i.parent().parent();"mobile"===e.renderMode&&(l=l.parent()),o.remove();var u='[data-aid="submit-'+e.elementId+"-"+e.renderMode+'"]',p=a?a.find(u):t(u);p.remove(),i.show(),l.css({top:d+"px",height:"auto"})}else if(e.postRedirectUrl.search("window.wsb.gotoAddress")>=0){var f=e.postRedirectUrl.match(/preview\/(?:desktop|mobile)\/(?:(?:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12})|(?:\d+))/)[0];window.wsb.gotoAddress(f)}else window.location=e.postRedirectUrl},b=function(a){f(!0);var n=e.sendErrorMessage,r=e.errorTitle,d="error";429===a.status&&e.tooManyRequestsErrorMessage&&(n=e.tooManyRequestsErrorMessage,e.tooManyRequestsErrorTitle&&(r=e.tooManyRequestsErrorTitle),d="warning"),c()?alert(n):t("<div></div>").sfGrowl({title:r||"",content:n,icon:d,fadetime:3e3})},y=e.mailerUrl;t.browser.msie&&t.browser.version<10&&window.location.href.indexOf("http://")>=0&&(y=y.replace("https://","http://"));var w={type:"POST",url:y,crossDomain:!0,data:JSON.stringify(h)};if(e.gemSubmit&&1==e.resellerId&&""!=o){var x=(d||"").split(" "),M=x[0],k=x.slice(1).join(" "),q={email:o,suppressed:l};M&&(q.firstName=M),k&&(q.lastName=k);var j=[e.gemSubmitUrl,e.orionId,e.domainName].join("/"),C={type:"POST",url:j,crossDomain:!0,data:q,dataType:"json"};t.when(t.ajax(w),t.ajax(C)).then(I).fail(b)}else t.when(t.ajax(w)).then(I).fail(b);f(!1)}}var o,i,l="form-button-disabled",u="form-value-invalid",s=e.showMessage,p=e.isPreview,f=function(e){e?(o.removeClass(l),o.removeAttr("disabled")):(o.addClass(l),o.attr("disabled","disabled"))},c=function(){{var e="#mobile-site-view";a?a.find(e):t(e)}return t(e).length>0},g=function(){var n='[data-field-container-groupId="'+e.groupId+'"]',r="[data-date-elementId]",d=a?a.find(n).find(r):t(n).find(r);if(d&&d.length){var o=t.map(d,function(e){return{elementId:t(e).attr("data-date-elementId"),subIndex:t(e).attr("data-subIndex")||0,val:"span"===(t(e).prop("tagName")||"").toLowerCase()?t(e).text():t(e).val()}}),i={};t.each(o,function(e,t){var a=t.elementId;a in i?i[a].push(t):i[a]=[t]});for(elementId in i){var l=t.map(i[elementId].sort(function(e,t){return e.subIndex-t.subIndex}),function(e){return e.val}).join(" "),u='[data-aid="datetime-value-'+elementId+'"]';a?a.find(u).val(l):t(u).val(l)}}},h=function(e){var a=t(e),n=t(e).attr("data-formType"),r=0;return r="hidden"===t(a).attr("type")?"file"===n?t(a).parent().offset().top+1:t(a).prev().offset().top+1:a.offset().top,parseInt(r)},m=function(e){var a=t(e),n=t(e).attr("data-formType"),r=0;return r="hidden"===t(a).attr("type")?"file"===n?t(a).parent().offset().left+1:t(a).prev().offset().left+1:a.offset().left,parseInt(r)},v=function(e,t){var a=h(e),n=h(t);return a!=n?a-n:m(e)-m(t)},I=function(){var n='[data-groupId="'+e.groupId+'"]',r=a?a.find(n):t(n);r.sort(function(e,t){return v(e,t)}).each(function(a){var n=100*e.groupIdInt;t(this).attr("tabindex",n+a)})},b=function(){var n='[data-groupId="'+e.groupId+'"]',r=a?a.find(n):t(n);t.each(r,function(e,a){var n=t(a).attr("placeholder");n&&t(a).watermark(n)})},y=function(r){var d=!0,o=t(r),i=o.val(),l=o.attr("data-formType"),s=Boolean(o.attr("required"));if(s){if("radio"==l||"checkbox"==l){var p=o.attr("name"),c='input[name="'+p+'"]:checked',g=a?a.find(c):t(c),h='input[name="'+p+'"]',m=a?a.find(h):t(h);0!=g.length||m.is(":focus")||(d=!1)}else d=Boolean(i);o.attr("data-placeholder",d?"":e.requiredValidationMessage)}return d&&("email"===l?(n.validateEmailAddress(i)||(d=!1),s||0!==i.length||(d=!0),o.attr("data-placeholder",d?"":e.emailValidationMessage)):"date"==l?"time"===o.attr("data-datetime-type")?(n.validateTime(i)||(d=!1),s||0!==i.length||(d=!0),o.attr("data-placeholder",d?"":e.dateValidationMessage)):(n.validateDate(i)||(d=!1),s||0!==i.length||(d=!0),o.attr("data-placeholder",d?"":e.dateValidationMessage)):"input"===l&&i.length>100?(d=!1,o.val(i.substr(0,100)),o.attr("data-placeholder",d?"":e.lengthValidationMessage)):"paragraph"===l&&i.length>4e3?(d=!1,o.val(i.substr(0,4e3)),o.attr("data-placeholder",d?"":e.longLengthValidationMessage)):"file"===l&&i.length<=0&&s&&(d=!1)),o.parents('[data-field-container-groupId ="'+e.groupId+'"]').data("valid",d),d?(o.removeClass(u),M()):(o.addClass(u),f(!1)),d},w='[data-groupId="'+e.groupId+'"][type="hidden"][data-formType="file"],[data-groupId="'+e.groupId+'"][type="text"], [data-groupId="'+e.groupId+'"][type="email"], textarea[data-groupId="'+e.groupId+'"], [data-groupId="'+e.groupId+'"][type="radio"], [data-groupId="'+e.groupId+'"][type="checkbox"]',x=a?a.find(w):t(w),M=function(){for(var a=!0,n=0,r=x.length;r>n;n++)if(!t(x[n]).parents('[data-field-container-groupId ="'+e.groupId+'"]').data("valid")){f(!1),a=!1;break}return a&&f(!0),a},T=function(){for(var e=!0,t=0,a=x.length;a>t;t++)y(x[t])||(f(!1),e=!1);return e},k=function(){t.each(x,function(a,n){var r=t(n).attr("data-formType");if("date"===r)t(n).parents('[data-field-container-groupId ="'+e.groupId+'"]').data("valid",!0);else{var d=Boolean(t(n).attr("required"));t(n).parents('[data-field-container-groupId ="'+e.groupId+'"]').data("valid",!d)}});{var n='[data-groupId="'+e.groupId+'"][type="text"], [data-groupId="'+e.groupId+'"][type="email"], textarea[data-groupId="'+e.groupId+'"]';a?a.find(n):t(n)}t(n).on("keyup paste",function(e){("keyup"!==e.type||9!==e.which)&&y(this)}).on("blur",function(){var e=y(this);if(!e){var a=t(this),n=a.attr("data-placeholder");n&&""!=n&&(a.attr("data-value",a.attr("value")||""),a.attr("placeholder",n),a.attr("value",""))}}).on("focus",function(){var e=t(this),a=e.attr("data-value");a&&e.attr("value",a)});var r='[data-groupId="'+e.groupId+'"][type="radio"],[data-groupId="'+e.groupId+'"][type="checkbox"]',d=a?a.find(r):t(r);t(d).on("change focusin focusout",function(){y(this)});var o='[data-groupId="'+e.groupId+'"][type="hidden"][data-formType=file]',i=a?a.find(o):t(o);t(i).on("change",function(){y(this)})},q=function(){var n=0,r='div[data-label-container-groupId="'+e.groupId+'"]',d='div[data-field-container-groupId="'+e.groupId+'"]',o=a?a.find(r):t(r),i=a?a.find(d):t(d),l=o.addClass(e.labelCssClass),u=i.addClass(e.fieldCssClass);if("1"===e.labelOrientation){t.each(l,function(e,a){var r=t(a).width();n=Math.max(n,r)});var s=t(l[0]).parent().parent().width()-n-12;t.each(l,function(e,a){t(a).width(n)}),t.each(u,function(e,a){t(a).width(s)})}},j=function(){var n='[data-field-container-groupId="'+e.groupId+'"]',r=a?a.find(n):t(n);t.each(r.find("[data-content]"),function(e,a){var n=t(a).attr("data-content");n&&t(a).sfTipper({style:"qt",content:n,target:t(a)})})},C=function(){var n='[data-groupId="'+e.groupId+'"][data-formType="address"]',r=a?a.find(n):t(n);if(0!=r.length){var d=function(e){e&&t.each(r,function(t,a){new e.places.Autocomplete(a,{})})};p?window.require(["common/geo/googleMaps"],function(e){var t=e({loadUsingClient:!0});t.done(function(e){d(e)})}):window.require(["common/geo/googleMaps"],function(e){var t=e({loadingMode:"publish"});t.done(function(e){d(e)})})}},U=function(){var n='[data-field-container-groupId ="'+e.groupId+'"]',r=a?a.find(n):t(n),d=r.find('[data-datetime-type="date"]');if(d&&d.length){var o=new Date,i=[o.getMonth()+1,o.getDate(),o.getFullYear()].join("/");t.each(t(d),function(e,a){t(a).attr("value",i).sfDatePicker({onChange:function(e){y(e)}})})}};t(document).ready(function(){var n='[data-aid="submit-'+e.elementId+"-"+e.renderMode+'"]',r="#"+e.messageBoxId;o=a?a.find(n):t(n),o.click(d),f(!1),i=a?a.find(r):t(r),q(),I(),b(),k(),j(),C(),U()})})}function t(e){require(["jquery","wsbcore/upload"],function(t){var n,r,d=e.domainName,o=window.location.href,i='[data-aid="uploader-'+e.elementId+'"]',l='[data-aid="uploaded-file-'+e.elementId+'"]',u='[data-aid="file-'+e.elementId+'"]',s="#uploader-"+e.elementId+"-file-size-error-message",p=a?a.find(i):t(i),f=a?a.find(l):t(l),c=a?a.find(u):t(u),g=a?a.find(s):t(s),h=function(){setTimeout(function(){p.find(".sf-upload-btns").width(100).height(r),p.find(".sf-upload-status").empty().text(e.fileDisplayText),p.find(".sf-upload-scroller").hide()},1)},m=function(){c.val("").trigger("change"),f.empty()},v=function(){p.hide(),f.show()},I=function(){p.show(),f.hide()};p.sfUpload({ddEnabled:!1,expectData:!0,condensed:!0,maxFileSize:10485760,uploadPath:e.uploadUrl+"?domainName="+d+"&elementID="+e.elementId+"&pageUrl="+encodeURIComponent(o),onUpload:function(e,t,a){a(t)},onSuccess:function(a,n,r){var d,o;r&&("string"==typeof r&&(r=JSON.parse(r)),r&&"object"==typeof r&&(d=r.url,o=r.filename)),d&&(c.val(d).trigger("change"),f.empty().append(t("<a/>").attr("href",d).append(o||e.fileUploadSuccessMessage)).append("&nbsp;&nbsp;").append(t('<a href="javascript:void(0)"></a>').addClass("delete-file-btn").attr("title",e.deleteLinkText).click(function(){I(),m()}))),v()},onStart:function(e,t){if(g.hide(),e&&e.length){var a=p.find(".sf-upload-btns");a.width()>0&&(n=a.width()),a.height()>0&&(r=a.height()),p.find(".sf-upload-btns").width(0).height(0),p.find(".sf-upload-scroller").show(),p.find(".sf-upload-header").hide()}t&&t.length&&g.show()},onError:function(){h(),g.show()},onFinish:function(){h()},txt:{select:e.uploadButtonText,upload:"",intro:e.uploadButtonPrompt,introWithDrop:"",introMaxItems:"",statusPending:"",statusUploading:"",statusFinished:"",pending:"",finished:"",uploading:""}})})}var a;return{initializeSubmitButton:e,initializeUploader:t,setDom:function(e){a=e}}});
//# sourceMappingURL=customForm.published.js.map